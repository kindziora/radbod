{"code":"var kjs=function(e){var t={};function i(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var s in e)i.d(n,s,function(t){return e[t]}.bind(null,s));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,\"a\",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p=\"\",i(i.s=1)}([function(module,__webpack_exports__,__webpack_require__){\"use strict\";__webpack_require__.d(__webpack_exports__,\"a\",(function(){return kelement}));class kelement{constructor(el,$scope,counter,dom,template){this._isListItem=!1,this.$el=el,this.$scope=$scope,this.dom=dom,this.setId(this.$el.getAttribute(\"data-id\")||null,counter),this.setTemplate(template),this.$el.hasAttribute(\"data-view\")||(this.$el.setAttribute(\"data-view\",this.id),template||this.setTemplate(eval(\"(data)=>`\"+this.$el.innerHTML+\"`\")))}getValue(){return this.$el.value}getName(){return this.$el.getAttribute(\"data-name\")}setId(e,t){let i=e||\"element-\"+t;this.$el.setAttribute(\"data-id\",i),this.id=i}update(e){for(let t=0;t<e.length;t++){let i=e[t];console.log(i.op,i.value),void 0!==this[i.op]&&this[i.op](i)}}setTemplate(e){this.template=e}render(e){this.template?this.$el.innerHTML=this.template(e):this.$el.innerHTML=e.value}replace(e){this.render(e)}add(e){this.render(e)}remove(e){var t;this.isListItem()?null===(t=this.getListContainer())||void 0===t||t.remove(e):this.$el.remove()}isListItem(){return this._isListItem}setIsListItem(e){this._isListItem=e}getListContainer(){return this._listContainer}setListContainer(e){this._listContainer=e}}},function(e,t,i){\"use strict\";i.r(t);class n{constructor(e,t,i){this.name=\"\",this.interactions={},this.dom=e,this.store=t,this.interactions=i,this.name=this.dom.name,this.bindEvents()}getName(){return this.name}bindEvents(){var e,t,i,n,s,l,a,r,o,d,h,u,m,v;null===(e=this.store.events)||void 0===e||e.addEvent(this.name,\"/\",\"change\",this.update,this),null===(t=this.store.events)||void 0===t||t.addEvent(this.store.name,\"/\",\"change\",this.update,this),null===(i=this.store.events)||void 0===i||i.addEvent(this.name,\"/\",\"change\",null===(s=null===(n=this.interactions)||void 0===n?void 0:n[\"/\"])||void 0===s?void 0:s.change,this),null===(l=this.store.events)||void 0===l||l.addEvent(this.store.name,\"/\",\"change\",null===(r=null===(a=this.interactions)||void 0===a?void 0:a[\"/\"])||void 0===r?void 0:r.change,this);for(let e in this.interactions)for(let t in this.interactions[e])for(let i in this.dom.elementByName[e]){let n=this.dom.elementByName[e][i].$el,s=this.dom.elementByName[e][i].id,l=t.split(\"#\");l.length>1?s===l[1]&&(null===(o=this.store.events)||void 0===o||o.addEvent(this.name,e,t,null===(h=null===(d=this.interactions)||void 0===d?void 0:d[e])||void 0===h?void 0:h[t]),n.addEventListener(l[0],n=>{var s;null===(s=this.store.events)||void 0===s||s.dispatchEvent(this.name,e,t,{field:this.dom.elementByName[e][i],ev:n},this.store.data)})):(null===(u=this.store.events)||void 0===u||u.addEvent(this.name,e,t,null===(v=null===(m=this.interactions)||void 0===m?void 0:m[e])||void 0===v?void 0:v[t]),n.addEventListener(t,n=>{var s;null===(s=this.store.events)||void 0===s||s.dispatchEvent(this.name,e,t,{field:this.dom.elementByName[e][i],ev:n},this.store.data)}))}}update(e){for(let t=0;t<e.length;t++){let i=e[t];this.dom.getBestMatchingElements(i.path).forEach(e=>e.update([i]))}}}var s=i(0);class l extends s.a{replace(e){this.$el.setAttribute(\"value\",e.value),this.$el.value=e.value}add(e){this.$el.setAttribute(\"value\",e.value),this.$el.value=e.value}render(e){console.log(\"RENDER\",e)}}class a extends l{render(e){return this.$el.outerHTML=`<input type=\"radio\" data-name=\"${e.path}\" value=\"${e.value}\" />`,this.$el.outerHTML}getValue(e=!1){var t;return null===(t=this.$scope.querySelector(':scope input[data-name=\"'+this.getName()+'\"]:checked'))||void 0===t?void 0:t.value}}class r extends l{render(e){return this.$el.outerHTML=`<input type=\"checkbox\" data-name=\"${e.path}\" value=\"${e.value}\" />`,this.$el.outerHTML}getValue(e=!1){return e?super.getValue():this.getFields().filter(e=>e.checked).map(e=>e.value)}getFields(){return Array.from(this.$scope.querySelectorAll(':scope input[data-name=\"'+this.getName()+'\"]'))}}class o extends l{render(e){return this.$el.outerHTML=`<input type=\"text\" data-name=\"${e.path}\" value=\"${e.value}\" />`,this.$el.outerHTML}}class d extends l{render(e){return this.$el.outerHTML=`<input type=\"range\" data-name=\"${e.path}\" value=\"${e.value}\" />`,this.$el.outerHTML}}class h extends l{render(e){return this.$el.outerHTML=`<input type=\"file\" data-name=\"${e.path}\" value=\"${e.value}\" />`,this.$el.outerHTML}}class u extends s.a{render(e){return this.$el.outerHTML=`<button data-name=\"${e.path}\">${e.value}</button>`,this.$el.outerHTML}}class m extends s.a{constructor(){super(...arguments),this._listItems={},this._listItemsByName={}}getNativeListItems(){var e;return null===(e=this.$el)||void 0===e?void 0:e.children}getListItems(e=!1){return e?this._listItems:this.mapListItems()}mapListItems(){var e;let t={},i=this.getNativeListItems();for(let n in i){let s=null===(e=i[n])||void 0===e?void 0:e.getAttribute(\"data-id\");if(s in this.dom.element)t[s]=this.dom.element[s],this._listItems[s]=this.dom.element[s],this._listItemsByName[this.dom.element[s].getName()]=this.dom.element[s];else{let e=this.dom.loadElement(i[n]);e&&(t[e.id]=e,this._listItems[e.id]=e,this._listItemsByName[e.getName()]=e)}}return t}replace(e){console.log(\"replace whole list\")}add(e){var t,i,n;let s=\"afterbegin\",l=null===(i=null===(t=e.path)||void 0===t?void 0:t.split(\"/\"))||void 0===i?void 0:i.pop();if(isNaN(l))console.log(\"failed pointer from path\",e.path);else{let t=this.getListItems(),i=parseInt(l);if(0===i&&this.dom.insertElementByElement(this,s,this.renderItem(e)),i>Object.keys(t).length-1&&(s=\"beforeend\",this.dom.insertElementByElement(this,s,this.renderItem(e))),i>0&&i<Object.keys(t).length-1){let t=null===(n=e.path)||void 0===n?void 0:n.split(\"/\");t.pop(),t.push(i-1);let l=t.join(\"/\");s=\"afterend\",this._listItemsByName[l]?this.dom.insertElementByElement(this._listItemsByName[l],s,this.renderItem(e)):console.log(\"failed to find point to insert list-item\",l)}}let a=this.$scope.querySelector(`:scope data-name=\"${e.path}\"`),r=null;return a&&(r=this.dom.loadElement(a)),r}remove(e){var t;super.remove(e);let i=null===(t=this.dom.getBestMatchingElements(e.path))||void 0===t?void 0:t.pop();i&&this.dom.removeElement(i)}render(){}renderItem(e){var t,i;return`<div data-type=\"list-item\" data-index=\"${e.index}\" data-name=\"${e.path}\">${null===(i=null===(t=e)||void 0===t?void 0:t.html)||void 0===i?void 0:i.trim()}</div>`}}class v extends m{renderItem(e){var t,i;return`<option data-type=\"list-item\" data-index=\"${e.index}\" data-name=\"${e.path}\">${null===(i=null===(t=e)||void 0===t?void 0:t.html)||void 0===i?void 0:i.trim()}</option>`}render(e){}}class c extends s.a{}class p{constructor(e,t){this._area={},this._identifier=\"[data-name]\",this.element={},this.elementByName={},this.elementTypes={input:l,text:o,radio:a,checkbox:r,range:d,file:h,button:u,list:m,select:v,textarea:c,kelement:s.a},this.counter=0,this.id=\"component-0\",this.name=\"component-x\",this._area=e,this.setId(),e.hasAttribute(\"data-name\")&&(this.name=e.getAttribute(\"data-name\")||this.name),this.addTypes(t),this.loadElements()}setTemplate(e){this.template=e}render(e){this.element={},this.elementByName={},this._area.innerHTML=this.template(e),this.loadElements()}addTypes(e){for(let t in e)this.elementTypes[t]=e[t]}setId(){this.counter++;let e=\"component-\"+this.counter;this._area.setAttribute(\"data-id\",e),this.id=e}mapField(e,t){var i,n;switch(e){case\"input\":t.getAttribute(\"type\")&&(e=t.getAttribute(\"type\"));break;case\"ul\":e=\"list\",null===(i=t)||void 0===i||i.setAttribute(\"data-type\",\"list\")}return void 0===this.elementTypes[e]&&(e=\"kelement\"),\"list\"==(null===(n=t)||void 0===n?void 0:n.getAttribute(\"data-type\"))&&(e=\"list\"),e}insertElementByElement(e,t=\"beforeend\",i){var n;null===(n=e.$el)||void 0===n||n.insertAdjacentHTML(t,i)}createElement(e,t){let i=this.mapField(e.tagName.toLowerCase(),e);return this.elementTypes[i].prototype instanceof n?this.elementTypes[i]:new this.elementTypes[i](e,this._area,t,this)}detectType(e){var t,i,n,s,l,a,r;let o=null===(n=null===(i=null===(t=e)||void 0===t?void 0:t.getName())||void 0===i?void 0:i.split(\"/\"))||void 0===n?void 0:n.pop();if(!isNaN(o)||\"list-item\"==(null===(l=null===(s=e)||void 0===s?void 0:s.$el)||void 0===l?void 0:l.getAttribute(\"data-type\"))){e.setIsListItem(!0);let t=null===(r=null===(a=e.$el)||void 0===a?void 0:a.parentElement)||void 0===r?void 0:r.getAttribute(\"data-id\");t&&this.element[t]&&e.setListContainer(this.element[t])}}loadElement(e,t){this.counter++;let i=this.createElement(e,this.counter);return this.detectType(i),this.addElement(i),this.addElementByName(i),i}loadElements(){let e=this._area.querySelectorAll(this._identifier);try{e.forEach((e,t)=>this.loadElement(e,t))}catch(e){console.log(e)}}removeElement(e){e.$el.remove(),delete this.element[e.id]}addElement(e){this.element[e.id]=e}addElementByName(e){void 0===this.elementByName[e.getName()]&&(this.elementByName[e.getName()]=[]),this.elementByName[e.getName()].push(e)}getBestMatchingElements(e){let t=[];if(void 0!==this.elementByName[e])t=this.elementByName[e];else{let i=e.split(\"/\");i.length>1&&(i.pop(),t=this.getBestMatchingElements(i.join(\"/\")))}return t}}class g{constructor(){this.event={},this.eventById={}}construct(){}addFunction(e,t,i){let n=function(e,t=0){let i=3735928559^t,n=1103547991^t;for(let t,s=0;s<e.length;s++)t=e.charCodeAt(s),i=Math.imul(i^t,2654435761),n=Math.imul(n^t,1597334677);return i=Math.imul(i^i>>>16,2246822507)^Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507)^Math.imul(i^i>>>13,3266489909),4294967296*(2097151&n)+(i>>>0)}(e.toString());return this.eventById[n]=e.bind(i||this),n}getFunction(e){return this.eventById[e]}removeEvent(e){delete this.eventById[e]}addEvent(e,t,i,n,s){if(\"function\"!=typeof n)return;let l=this.addFunction(n,{component:e,id:t,name:i},s);return void 0===this.event[e]&&(this.event[e]={}),void 0===this.event[e][t]&&(this.event[e][t]={}),void 0===this.event[e][t][i]&&(this.event[e][t][i]=[]),-1===this.event[e][t][i].indexOf(l)&&this.event[e][t][i].push(l),l}dispatchEvent(e,t,i,n=null,s=null,l){var a,r;if(null===(r=null===(a=this.event[e])||void 0===a?void 0:a[t])||void 0===r?void 0:r[i]){let l=s,a=i.indexOf(\"pre_\")>-1||i.indexOf(\"post_\")>-1;a||(l=this.dispatchEvent(e,t,\"pre_\"+i,n,l));for(let s in this.event[e][t][i]){let a=this.event[e][t][i][s],r=this.getFunction(a)(n,l);if(void 0!==r&&(l=r),!1===l)break}return a||(l=this.dispatchEvent(e,t,\"post_\"+i,n,l)),l}return console.log(\"no listener for \",e,t,i),s}}class y{constructor(e,t,i,n){this._data={},this.patchQueue=[],this.events=e,this.dataH=t,this.component=i,this.name=i,this.createStore(i,n)}unmaskComponentName(e){return\"$\"===e.charAt(0)?e.substr(1):e}createStore(e,t){let i=(t,n=`/$${e}`)=>new Proxy(t,{get:(e,t)=>{var s,l,a;if(\"object\"==typeof e[t]&&null!==e[t]||\"function\"==typeof e[t]){let r=n+\"/\"+t;return\"$\"===t.charAt(0)&&(r=t),this.dataH.pxy[r]=(null===(s=this.dataH)||void 0===s?void 0:s.pxy[r])||i(e[t],r),null===(a=null===(l=this.dataH)||void 0===l?void 0:l.pxy)||void 0===a?void 0:a[r]}return e[t]},set:(t,i,s)=>{let l={op:void 0===t[i]?\"add\":\"replace\",path:n+\"/\"+i,value:s};return t[i]!==s&&(s=this.changeStore(e,l)),t[i]=s,!0},deleteProperty:(t,i)=>(console.log(\"delete\",t[i]),delete t[i],this.changeStore(e,{op:\"remove\",path:n+\"/\"+i}),!0),defineProperty:(e,t,i)=>(i&&\"value\"in i&&(e[t]=i.value),e)});this.dataH.pxy[`$${e}`]=this._data=i(t)}changeStore(e,t){var i,n;let s=null;this.patchQueue.push(t);let l=null===(i=this.events)||void 0===i?void 0:i.dispatchEvent(e,\"/\",\"change\",[t],this.data);try{s=null===(n=this.events)||void 0===n?void 0:n.dispatchEvent(e,t.path,t.op,[t],this.data)}catch(e){s=l}return s}get data(){return this._data}}class f{constructor(e){this.store={},this.pxy={},this.events=e}createStore(e,t){return this.store[e]=new y(this.events,this,e,t),this.store[e]}getStore(e){return this.store[e]}changeStores(e,t){console.log(e,t)}}i.d(t,\"app\",(function(){return $}));class ${constructor(){this.components={},this.dataH=new f(new g)}createComponent(e,t,i,s,l){var a,r;let o=this.dataH.createStore(e,i),d=document.createElement(\"component\");return d.innerHTML=null===(a=t)||void 0===a?void 0:a[e](i),d.setAttribute(\"data-name\",e),this.components[e]=new n(new p(d,l),o,s),this.components[e].dom.setTemplate(null===(r=t)||void 0===r?void 0:r[e]),this.bindViews(e,t),this.components[e]}bindViews(e,t){var i,n,s;for(let l in this.components[e].dom.element){let a=this.components[e].dom.element[l];a.$el.hasAttribute(\"data-view\")&&a.setTemplate(null===(i=t)||void 0===i?void 0:i[null===(s=null===(n=a)||void 0===n?void 0:n.$el)||void 0===s?void 0:s.getAttribute(\"data-view\")])}}removeComponent(e){delete this.components[e]}render(e){}}}]);","extractedComments":[]}